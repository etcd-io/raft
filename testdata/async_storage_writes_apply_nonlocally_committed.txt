# The leader commits and applies a log entry that it does not yet have in
# its local log (for example because its local disk stalls).

log-level none
----
ok

add-nodes 3 voters=(1,2,3) index=10 async-storage-writes=true
----
ok

campaign 1
----
ok

stabilize
----
ok (quiet)

propose 1 prop_1
----
ok

process-ready 1 2 3
----
ok (quiet)

deliver-msgs 1 2 3
----
ok (quiet)

stabilize 2
----
ok (quiet)

log-level info
----
ok

deliver-msgs 1
----
2->1 MsgAppResp Term:1 Log:0/12

process-ready 1
----
<empty Ready>

log-level none
----
ok

stabilize 3
----
ok (quiet)

log-level info
----
ok

deliver-msgs 1
----
3->1 MsgAppResp Term:1 Log:0/12

process-ready 1
----
Ready MustSync=false:
HardState Term:1 Vote:1 Commit:12
Messages:
1->2 MsgApp Term:1 Log:1/12 Commit:12
1->3 MsgApp Term:1 Log:1/12 Commit:12
1->AppendThread MsgStorageAppend Term:1 Log:0/0 Commit:12 Vote:1 Responses:[AppendThread->1 MsgStorageAppendResp Term:1 Log:1/12]

process-apply-thread 1
----
no apply work to perform

stabilize 1
----
> 1 processing append thread
  Processing:
  1->AppendThread MsgStorageAppend Term:0 Log:0/0 Entries:[1/12 EntryNormal "prop_1"]
  Responses:
  1->1 MsgAppResp Term:1 Log:0/12
  AppendThread->1 MsgStorageAppendResp Term:1 Log:1/12
  Processing:
  1->AppendThread MsgStorageAppend Term:1 Log:0/0 Commit:12 Vote:1
  Responses:
  AppendThread->1 MsgStorageAppendResp Term:1 Log:1/12
> 1 receiving messages
  1->1 MsgAppResp Term:1 Log:0/12
  AppendThread->1 MsgStorageAppendResp Term:1 Log:1/12
  AppendThread->1 MsgStorageAppendResp Term:1 Log:1/12
  INFO entry at index 12 missing from unstable log; ignoring
> 1 handling Ready
  Ready MustSync=false:
  CommittedEntries:
  1/12 EntryNormal "prop_1"
  Messages:
  1->ApplyThread MsgStorageApply Term:0 Log:0/0 Entries:[1/12 EntryNormal "prop_1"] Responses:[ApplyThread->1 MsgStorageApplyResp Term:0 Log:0/0 Entries:[1/12 EntryNormal "prop_1"]]
> 1 processing apply thread
  Processing:
  1->ApplyThread MsgStorageApply Term:0 Log:0/0 Entries:[1/12 EntryNormal "prop_1"]
  Responses:
  ApplyThread->1 MsgStorageApplyResp Term:0 Log:0/0 Entries:[1/12 EntryNormal "prop_1"]
> 1 receiving messages
  ApplyThread->1 MsgStorageApplyResp Term:0 Log:0/0 Entries:[1/12 EntryNormal "prop_1"]

stabilize 2 3
----
> 2 receiving messages
  1->2 MsgApp Term:1 Log:1/12 Commit:12
> 3 receiving messages
  1->3 MsgApp Term:1 Log:1/12 Commit:12
> 2 handling Ready
  Ready MustSync=false:
  HardState Term:1 Vote:1 Commit:12
  CommittedEntries:
  1/12 EntryNormal "prop_1"
  Messages:
  2->AppendThread MsgStorageAppend Term:1 Log:0/0 Commit:12 Vote:1 Responses:[2->1 MsgAppResp Term:1 Log:0/12]
  2->ApplyThread MsgStorageApply Term:0 Log:0/0 Entries:[1/12 EntryNormal "prop_1"] Responses:[ApplyThread->2 MsgStorageApplyResp Term:0 Log:0/0 Entries:[1/12 EntryNormal "prop_1"]]
> 3 handling Ready
  Ready MustSync=false:
  HardState Term:1 Vote:1 Commit:12
  CommittedEntries:
  1/12 EntryNormal "prop_1"
  Messages:
  3->AppendThread MsgStorageAppend Term:1 Log:0/0 Commit:12 Vote:1 Responses:[3->1 MsgAppResp Term:1 Log:0/12]
  3->ApplyThread MsgStorageApply Term:0 Log:0/0 Entries:[1/12 EntryNormal "prop_1"] Responses:[ApplyThread->3 MsgStorageApplyResp Term:0 Log:0/0 Entries:[1/12 EntryNormal "prop_1"]]
> 2 processing append thread
  Processing:
  2->AppendThread MsgStorageAppend Term:1 Log:0/0 Commit:12 Vote:1
  Responses:
  2->1 MsgAppResp Term:1 Log:0/12
> 3 processing append thread
  Processing:
  3->AppendThread MsgStorageAppend Term:1 Log:0/0 Commit:12 Vote:1
  Responses:
  3->1 MsgAppResp Term:1 Log:0/12
> 2 processing apply thread
  Processing:
  2->ApplyThread MsgStorageApply Term:0 Log:0/0 Entries:[1/12 EntryNormal "prop_1"]
  Responses:
  ApplyThread->2 MsgStorageApplyResp Term:0 Log:0/0 Entries:[1/12 EntryNormal "prop_1"]
> 3 processing apply thread
  Processing:
  3->ApplyThread MsgStorageApply Term:0 Log:0/0 Entries:[1/12 EntryNormal "prop_1"]
  Responses:
  ApplyThread->3 MsgStorageApplyResp Term:0 Log:0/0 Entries:[1/12 EntryNormal "prop_1"]
> 2 receiving messages
  ApplyThread->2 MsgStorageApplyResp Term:0 Log:0/0 Entries:[1/12 EntryNormal "prop_1"]
> 3 receiving messages
  ApplyThread->3 MsgStorageApplyResp Term:0 Log:0/0 Entries:[1/12 EntryNormal "prop_1"]

stabilize
----
> 1 receiving messages
  2->1 MsgAppResp Term:1 Log:0/12
  3->1 MsgAppResp Term:1 Log:0/12
